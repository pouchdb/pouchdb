/*! IndexedDBShim */
var idbModules={},logger={};logger.log=logger.error=logger.warn=logger.debug=function(){typeof DEBUG!="undefined"&&console.log.apply(console,arguments)},function(a){function b(a,b,c,d){c.target=b,typeof b[a]=="function"&&b[a].apply(b,[c]),typeof d=="function"&&d()}function c(a,b,c){logger.log(a,b,c);var d=new DOMException.constructor(0,b);throw d.name=a,d.message=b,d.stack=arguments.callee.caller,d}var d=function(){this.length=0,this._items=[]};d.prototype={contains:function(a){return-1!==this._items.indexOf(a)},item:function(a){return this._items[a]},indexOf:function(a){return this._items.indexOf(a)},push:function(a){this._items.push(a),this.length+=1},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length}},a.util={throwDOMException:c,callback:b,quote:function(a){return"'"+a+"'"},StringList:d}}(idbModules),function(a){var b=function(){return{encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}}}();a.Sca=b}(idbModules),function(a){var b=["","number","string","boolean","object","undefined"],c=function(){return{encode:function(a){return b.indexOf(typeof a)+"-"+JSON.stringify(a)},decode:function(a){return typeof a=="undefined"?undefined:JSON.parse(a.substring(2))}}},d={number:c("number"),"boolean":c(),object:c(),string:{encode:function(a){return b.indexOf("string")+"-"+a},decode:function(a){return""+a.substring(2)}},"undefined":{encode:function(a){return b.indexOf("undefined")+"-undefined"},decode:function(a){return undefined}}},e=function(){return{encode:function(a){return d[typeof a].encode(a)},decode:function(a){return d[b[a.substring(0,1)]].decode(a)}}}();a.Key=e}(idbModules),function(a,b){var c=function(a,b){return{type:a,debug:b,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};a.Event=c}(idbModules),function(a){var b=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},c=function(){this.onblocked=this.onupgradeneeded=null};c.prototype=b,a.IDBRequest=b,a.IDBOpenRequest=c}(idbModules),function(a,b){var c=function(a,b,c,d){this.lower=a,this.upper=b,this.lowerOpen=c,this.upperOpen=d};c.only=function(a){return new c(a,a,!0,!0)},c.lowerBound=function(a,d){return new c(a,b,d,b)},c.upperBound=function(a){return new c(b,a,b,open)},c.bound=function(a,b,d,e){return new c(a,b,d,e)},a.IDBKeyRange=c}(idbModules),function(a,b){function c(c,d,e,f,g,h){this.__range=c,this.source=this.__idbObjectStore=e,this.__req=f,this.key=b,this.direction=d,this.__keyColumnName=g,this.__valueColumnName=h,this.source.transaction.__active||a.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this["continue"]()}c.prototype.__find=function(c,d,e,f){var g=this,h=["SELECT * FROM ",a.util.quote(g.__idbObjectStore.name)],i=[];h.push("WHERE ",g.__keyColumnName," NOT NULL"),g.__range&&(g.__range.lower||g.__range.upper)&&(h.push("AND"),g.__range.lower&&(h.push(g.__keyColumnName+(g.__range.lowerOpen?" >=":" >")+" ?"),i.push(a.Key.encode(g.__range.lower))),g.__range.lower&&g.__range.upper&&h.push("AND"),g.__range.upper&&(h.push(g.__keyColumnName+(g.__range.upperOpen?" <= ":" < ")+" ?"),i.push(a.Key.encode(g.__range.upper)))),h.push(" ORDER BY ",g.__keyColumnName),typeof c!="undefined"?(h.push(g.__range&&(g.__range.lower||g.__range.upper)?"AND":"WHERE"),h.push("key = ?"),i.push(a.Key.encode(c)),h.push("LIMIT 1")):h.push("LIMIT 1 OFFSET "+g.__offset),logger.log(h.join(" "),i),d.executeSql(h.join(" "),i,function(c,d){if(d.rows.length===1){var f=a.Key.decode(d.rows.item(0)[g.__keyColumnName]),h=g.__valueColumnName==="value"?a.Sca.decode(d.rows.item(0)[g.__valueColumnName]):a.Key.decode(d.rows.item(0)[g.__valueColumnName]);e(f,h)}else logger.log("Reached end of cursors"),e(b,b)},function(a,b){logger.log("Could not execute Cursor.continue"),f(b)})},c.prototype["continue"]=function(a){var c=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(d,e,f,g){c.__offset++,c.__find(a,d,function(a,d){c.key=a,c.value=d,f(typeof c.key!="undefined"?c:b,c.__req)},function(a){g(a)})})},c.prototype.advance=function(c){c<=0&&a.util.throwDOMException("Type Error - Count is invalid - 0 or negative",c);var d=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(a,e,f,g){d.__offset+=c,d.__find(b,a,function(a,b){d.__offset++,d.key=a,d.value=b,f(d,d.__req)},function(a){g(a)})})},c.prototype.update=function(c){var d=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,f,g,h){d.__find(b,e,function(b,f){var i="UPDATE "+a.util.quote(d.__idbObjectStore.name)+" SET value = ? WHERE key = ?";logger.log(i,c,b),e.executeSql(i,[a.Sca.encode(c),a.Key.encode(b)],function(a,c){c.rowsAffected===1?g(b):h("No rowns with key found"+b)},function(a,b){h(b)})},function(a){h(a)})})},c.prototype["delete"]=function(){var c=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(d,e,f,g){c.__find(b,d,function(e,h){var i="DELETE FROM  "+a.util.quote(c.__idbObjectStore.name)+" WHERE key = ?";logger.log(i,e),d.executeSql(i,[a.Key.encode(e)],function(a,c){c.rowsAffected===1?f(b):g("No rowns with key found"+e)},function(a,b){g(b)})},function(a){g(a)})})},a.IDBCursor=c}(idbModules),function(idbModules,undefined){function IDBIndex(a,b){this.indexName=a,this.__idbObjectStore=this.source=b}IDBIndex.prototype.__createIndex=function(indexName,keyPath,optionalParameters){var me=this,transaction=me.__idbObjectStore.transaction;transaction.__addToTransactionQueue(function(tx,args,success,failure){me.__idbObjectStore.__getStoreProps(tx,function(){function error(){idbModules.util.throwDOMException(0,"Could not create new index",arguments)}transaction.mode!==2&&idbModules.util.throwDOMException(0,"Invalid State error, not a version transaction",me.transaction);var idxList=JSON.parse(me.__idbObjectStore.__storeProps.indexList);typeof idxList[indexName]!="undefined"&&idbModules.util.throwDOMException(0,"Index already exists on store",idxList);var columnName=indexName;idxList[indexName]={columnName:columnName,keyPath:keyPath,optionalParams:optionalParameters},me.__idbObjectStore.__storeProps.indexList=JSON.stringify(idxList);var sql=["ALTER TABLE",idbModules.util.quote(me.__idbObjectStore.name),"ADD",columnName,"BLOB"].join(" ");logger.log(sql),tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.__idbObjectStore.name),[],function(tx,data){(function initIndexForRow(i){if(i<data.rows.length)try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=eval("value['"+keyPath+"']");tx.executeSql("UPDATE "+idbModules.util.quote(me.__idbObjectStore.name)+" set "+columnName+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(a,b){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}else logger.log("Updating the indexes in table",me.__idbObjectStore.__storeProps),tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[me.__idbObjectStore.__storeProps.indexList,me.__idbObjectStore.name],function(){me.__idbObjectStore.__setReadyState("createIndex",!0),success(me)},error)})(0)},error)},error)},"createObjectStore")})},IDBIndex.prototype.openCursor=function(a,b){var c=new idbModules.IDBRequest,d=new idbModules.IDBCursor(a,b,this.source,c,this.indexName,"value");return c},IDBIndex.prototype.openKeyCursor=function(a,b){var c=new idbModules.IDBRequest,d=new idbModules.IDBCursor(a,b,this.source,c,this.indexName,"key");return c},IDBIndex.prototype.__fetchIndexData=function(a,b){var c=this;return c.__idbObjectStore.transaction.__addToTransactionQueue(function(d,e,f,g){var h=["SELECT * FROM ",idbModules.util.quote(c.__idbObjectStore.name)," WHERE",c.indexName,"NOT NULL"],i=[];typeof a!="undefined"&&(h.push("AND",c.indexName," = ?"),i.push(idbModules.Key.encode(a))),logger.log("Trying to fetch data for Index",h.join(" "),i),d.executeSql(h.join(" "),i,function(a,c){var d;typeof b=="count"?d=c.rows.length:c.rows.length===0?d=undefined:b==="key"?d=idbModules.Key.decode(c.rows.item(0).key):d=idbModules.Sca.decode(c.rows.item(0).value),f(d)},g)})},IDBIndex.prototype.get=function(a){return this.__fetchIndexData(a,"value")},IDBIndex.prototype.getKey=function(a){return this.__fetchIndexData(a,"key")},IDBIndex.prototype.count=function(a){return this.__fetchIndexData(a,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){var IDBObjectStore=function(a,b,c){this.name=a,this.transaction=b,this.__ready={},this.__setReadyState("createObjectStore",typeof c=="undefined"?!0:c),this.indexNames=new idbModules.util.StringList};IDBObjectStore.prototype.__setReadyState=function(a,b){this.__ready[a]=b},IDBObjectStore.prototype.__waitForReady=function(a,b){var c=!0;if(typeof b!="undefined")c=typeof this.__ready[b]=="undefined"?!0:this.__ready[b];else for(var d in this.__ready)this.__ready[d]||(c=!1);if(c)a();else{logger.log("Waiting for to be ready",b);var e=this;window.setTimeout(function(){e.__waitForReady(a,b)},100)}},IDBObjectStore.prototype.__getStoreProps=function(a,b,c){var d=this;this.__waitForReady(function(){d.__storeProps?b(d.__storeProps):a.executeSql("SELECT * FROM __sys__ where name = ?",[d.name],function(a,c){c.rows.length!==1?b():(d.__storeProps={name:c.rows.item(0).name,indexList:c.rows.item(0).indexList,autoInc:c.rows.item(0).autoInc,keyPath:c.rows.item(0).keyPath},b(d.__storeProps))},function(){b()})},c)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,callback){function getNextAutoIncKey(){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(a,b){b.rows.length!==1?callback(0):callback(b.rows.item(0).seq)},function(a,b){idbModules.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",b)})}var me=this;me.__getStoreProps(tx,function(props){props||idbModules.util.throwDOMException(0,"Data Error - Could not locate defination for this table",props);if(props.keyPath){typeof key!="undefined"&&idbModules.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",props);if(value)try{var primaryKey=eval("value['"+props.keyPath+"']");primaryKey?callback(primaryKey):props.autoInc==="true"?getNextAutoIncKey():idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}else idbModules.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not")}else typeof key!="undefined"?callback(key):props.autoInc==="false"?idbModules.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",props):getNextAutoIncKey()})},IDBObjectStore.prototype.__insertData=function(tx,value,primaryKey,success,error){var paramMap={};typeof primaryKey!="undefined"&&(paramMap.key=idbModules.Key.encode(primaryKey));var indexes=JSON.parse(this.__storeProps.indexList);for(var key in indexes)try{paramMap[indexes[key].columnName]=idbModules.Key.encode(eval("value['"+indexes[key].keyPath+"']"))}catch(e){error(e)}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(key in paramMap)sqlStart.push(key+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key]);sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(idbModules.Sca.encode(value));var sql=sqlStart.join(" ")+sqlEnd.join(" ");logger.log("SQL for adding",sql,sqlValues),tx.executeSql(sql,sqlValues,function(a,b){success(primaryKey)},function(a,b){error(b)})},IDBObjectStore.prototype.add=function(a,b){var c=this;return c.transaction.__addToTransactionQueue(function(d,e,f,g){c.__deriveKey(d,a,b,function(b){c.__insertData(d,a,b,f,g)})})},IDBObjectStore.prototype.put=function(a,b){var c=this;return c.transaction.__addToTransactionQueue(function(d,e,f,g){c.__deriveKey(d,a,b,function(b){var e="DELETE FROM "+idbModules.util.quote(c.name)+" where key = ?";d.executeSql(e,[idbModules.Key.encode(b)],function(d,e){logger.log("Did the row with the",b,"exist? ",e.rowsAffected),c.__insertData(d,a,b,f,g)},function(a,b){g(b)})})})},IDBObjectStore.prototype.get=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d=idbModules.Key.encode(a);logger.log("Fetching",b.name,d),c.executeSql("SELECT * FROM "+idbModules.util.quote(b.name)+" where key = ?",[d],function(a,b){logger.log("Fetched data",b);try{if(0===b.rows.length)return e();e(idbModules.Sca.decode(b.rows.item(0).value))}catch(c){logger.log(c),e(undefined)}},function(a,b){f(b)})})})},IDBObjectStore.prototype["delete"]=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d=idbModules.Key.encode(a);logger.log("Fetching",b.name,d),c.executeSql("DELETE FROM "+idbModules.util.quote(b.name)+" where key = ?",[d],function(a,b){logger.log("Deleted from database",b.rowsAffected),e()},function(a,b){f(b)})})})},IDBObjectStore.prototype.clear=function(){var a=this;return a.transaction.__addToTransactionQueue(function(b,c,d,e){a.__waitForReady(function(){b.executeSql("DELETE FROM "+idbModules.util.quote(a.name),[],function(a,b){logger.log("Cleared all records from database",b.rowsAffected),d()},function(a,b){e(b)})})})},IDBObjectStore.prototype.count=function(a){var b=this;return b.transaction.__addToTransactionQueue(function(c,d,e,f){b.__waitForReady(function(){var d="SELECT * FROM "+idbModules.util.quote(b.name)+(typeof a!="undefined"?" WHERE key = ?":""),g=[];typeof a!="undefined"&&g.push(idbModules.Key.encode(a)),c.executeSql(d,g,function(a,b){e(b.rows.length)},function(a,b){f(b)})})})},IDBObjectStore.prototype.openCursor=function(a,b){var c=new idbModules.IDBRequest,d=new idbModules.IDBCursor(a,b,this,c,"key","value");return c},IDBObjectStore.prototype.index=function(a){var b=new idbModules.IDBIndex(a,this);return b},IDBObjectStore.prototype.createIndex=function(a,b,c){var d=this;c=c||{},d.__setReadyState("createIndex",!1);var e=new idbModules.IDBIndex(a,d);return d.__waitForReady(function(){e.__createIndex(a,b,c)},"createObjectStore"),d.indexNames.push(a),e},IDBObjectStore.prototype.deleteIndex=function(a){var b=new idbModules.IDBIndex(a,this,!1);return b.__deleteIndex(a),b},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(a){var b=0,c=1,d=2,e=function(d,e,f){if(typeof e=="number")this.mode=e,e!==2&&logger.log("Mode should be a string, but was specified as ",e);else if(typeof e=="string")switch(e){case"readonly":this.mode=c;break;case"readwrite":this.mode=b;break;default:this.mode=b}this.storeNames=typeof d=="string"?[d]:d;for(var g=0;g<this.storeNames.length;g++)f.objectStoreNames.contains(this.storeNames[g])||a.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[g]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=f,this.error=null,this.onabort=this.onerror=this.oncomplete=null;var h=this};e.prototype.__executeRequests=function(){if(this.__running&&this.mode!==d){logger.warn("Looks like the request set is already running",this.mode);return}this.__running=!0;var b=this;window.setTimeout(function(){b.mode!==2&&!b.__active&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",b.__active),b.db.__db.transaction(function(c){function f(b,c){c&&(d.req=c),d.req.readyState="done",d.req.result=b,delete d.req.error;var f=a.Event("success");a.util.callback("onsuccess",d.req,f),e++,h()}function g(b){d.req.readyState="done",d.req.error="DOMError";var c=a.Event("error",arguments);a.util.callback("onerror",d.req,c),e++,h()}b.__tx=c;var d=null,e=0;try{function h(){if(e>=b.__requests.length){b.__active=!1,b.__requests=[];return}d=b.__requests[e],d.op(c,d.args,f,g)}h()}catch(i){logger.error("An exception occured in transaction",arguments),typeof b.onerror=="function"&&b.onerror()}},function(){logger.error("An error in transaction",arguments),typeof b.onerror=="function"&&b.onerror()},function(){logger.log("Transaction completed",arguments),typeof b.oncomplete=="function"&&b.oncomplete()})},1)},e.prototype.__addToTransactionQueue=function(b,c){!this.__active&&this.mode!==d&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var e=new a.IDBRequest;return e.source=this.db,this.__requests.push({op:b,args:c,req:e}),this.__executeRequests(),e},e.prototype.objectStore=function(b){return new a.IDBObjectStore(b,this)},e.prototype.abort=function(){!this.__active&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},e.prototype.READ_ONLY=0,e.prototype.READ_WRITE=1,e.prototype.VERSION_CHANGE=2,a.IDBTransaction=e}(idbModules),function(a){var b=function(b,c,d,e){this.__db=b,this.version=d,this.__storeProperties=e,this.objectStoreNames=new a.util.StringList;for(var f=0;f<e.rows.length;f++)this.objectStoreNames.push(e.rows.item(f).name);this.name=c,this.onabort=this.onerror=this.onversionchange=null};b.prototype.createObjectStore=function(b,c){var d=this;c=c||{},c.keyPath=c.keyPath||null;var e=new a.IDBObjectStore(b,d.__versionTransaction,!1),f=d.__versionTransaction;return f.__addToTransactionQueue(function(f,g,h,i){function j(){a.util.throwDOMException(0,"Could not create new object store",arguments)}d.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",d.transaction);var k=["CREATE TABLE",a.util.quote(b),"(key BLOB",c.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");logger.log(k),f.executeSql(k,[],function(a,d){a.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[b,c.keyPath,c.autoIncrement?!0:!1,"{}"],function(){e.__setReadyState("createObjectStore",!0),h(e)},j)},j)}),d.objectStoreNames.push(b),e},b.prototype.deleteObjectStore=function(b){var c=function(){a.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},d=this;!d.objectStoreNames.contains(b)&&c("Object Store does not exist"),d.objectStoreNames.splice(d.objectStoreNames.indexOf(b),1);var e=d.__versionTransaction;e.__addToTransactionQueue(function(e,f,g,h){d.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",d.transaction),d.__db.transaction(function(d){d.executeSql("SELECT * FROM __sys__ where name = ?",[b],function(d,e){e.rows.length>0&&d.executeSql("DROP TABLE "+a.util.quote(b),[],function(){d.executeSql("DELETE FROM __sys__ WHERE name = ?",[b],function(){},c)},c)})})})},b.prototype.close=function(){},b.prototype.transaction=function(b,c){var d=new a.IDBTransaction(b,c||1,this);return d},a.IDBDatabase=b}(idbModules),function(a){var b=4194304;if(!window.openDatabase)return;var c=window.openDatabase("__sysdb__",1,"System Database",b);c.transaction(function(b){b.executeSql("SELECT * FROM dbVersions",[],function(a,b){},function(){c.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){},function(){a.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){a.util.throwDOMException("Could not create table __sysdb__ to save DB versions")});var d={open:function(d,e){function h(){if(g)return;var b=a.Event("error",arguments);f.readyState="done",f.error="DOMError",a.util.callback("onerror",f,b),g=!0}function i(g){var i=window.openDatabase(d,1,d,b);f.readyState="done",typeof e=="undefined"&&(e=g||1),(e<=0||g>e)&&a.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",e),i.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){b.executeSql("SELECT * FROM __sys__",[],function(b,j){var k=a.Event("success");f.source=f.result=new a.IDBDatabase(i,d,e,j),g<e?c.transaction(function(b){b.executeSql("UPDATE dbVersions set version = ? where name = ?",[e,d],function(){var b=a.Event("upgradeneeded");b.oldVersion=g,b.newVersion=e,f.transaction=f.result.__versionTransaction=new a.IDBTransaction([],2,f.source),a.util.callback("onupgradeneeded",f,b,function(){var b=a.Event("success");a.util.callback("onsuccess",f,b)})},h)},h):a.util.callback("onsuccess",f,k)},h)},h)},h)}var f=new a.IDBOpenRequest,g=!1;return c.transaction(function(a){a.executeSql("SELECT * FROM dbVersions where name = ?",[d],function(a,b){b.rows.length===0?a.executeSql("INSERT INTO dbVersions VALUES (?,?)",[d,e||1],function(){i(0)},h):i(b.rows.item(0).version)},h)},h),f},deleteDatabase:function(d){function g(b){if(f)return;e.readyState="done",e.error="DOMError";var c=a.Event("error");c.message=b,c.debug=arguments,a.util.callback("onerror",e,c),f=!0}function i(){c.transaction(function(b){b.executeSql("DELETE FROM dbVersions where name = ? ",[d],function(){e.result=undefined;var b=a.Event("success");b.newVersion=null,b.oldVersion=h,a.util.callback("onsuccess",e,b)},g)},g)}var e=new a.IDBOpenRequest,f=!1,h=null;return c.transaction(function(a){a.executeSql("SELECT * FROM dbVersions where name = ?",[d],function(a,c){if(c.rows.length===0){g("Database does not exist");return}var e=c.rows.item(0).version,f=window.openDatabase(d,1,d,b);f.transaction(function(a){a.executeSql("SELECT * FROM __sys__",[],function(a,b){var c=b.rows;(function d(b){b>=c.length?a.executeSql("DROP TABLE __sys__",[],function(){i()},g):a.executeSql("DROP TABLE "+c.item(b).name,[],function(){d(b+1)},function(){d(b+1)})})(0)},function(a){i()})},g)})},g),e},cmp:function(b,c){return a.Key.encode(b)>a.Key.encode(c)?1:b===c?0:-1}};a.shimIndexedDB=d}(idbModules),function(a,b){typeof a.openDatabase!="undefined"&&(a.shimIndexedDB=b.shimIndexedDB,a.shimIndexedDB&&(a.shimIndexedDB.__useShim=function(){a.indexedDB=b.shimIndexedDB,a.IDBDatabase=b.IDBDatabase,a.IDBTransaction=b.IDBTransaction,a.IDBCursor=b.IDBCursor,a.IDBKeyRange=b.IDBKeyRange})),a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB,typeof a.indexedDB=="undefined"&&typeof a.openDatabase!="undefined"?a.shimIndexedDB.__useShim():(a.IDBDatabase=a.IDBDatabase||a.webkitIDBDatabase,a.IDBTransaction=a.IDBTransaction||a.webkitIDBTransaction,a.IDBCursor=a.IDBCursor||a.webkitIDBCursor,a.IDBKeyRange=a.IDBKeyRange||a.webkitIDBKeyRange)}(window,idbModules);