{% include anchor.html edit="true" title="List active tasks" hash="active_tasks" %}

{% highlight js %}
PouchDB.activeTasks.list()
{% endhighlight %}

List all active database tasks. There are three types of internal tasks: `database_compaction`, `view_indexing`, and `replication`. PouchDB will report progress of these tasks to the active tasks API and remove tasks as soon as they are completed or have failed.

#### Example Usage:

{% highlight js %}
var tasks = PouchDB.activeTasks.list()
{% endhighlight %}

#### Example Result:

{% highlight js %}
[{
  "pid": Symbol("database_compaction"),
  "type": "database_compaction",
  "started_on": 1644334725318,
  "total_changes": 12,
  "changes_done": 3,
  "updated_on": 1644334725821,
  "progress": 25
}]
{% endhighlight %}

### Real-time updates

You can use [JavaScript Proxies](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy) to monitor calls to the active tasks API. For the `PouchDB.activeTasks.add()` function, which is used internally to announce new tasks to PouchDB, you can monitor calls as follows:

{% highlight js %}
PouchDB.activeTasks.add = new Proxy(PouchDB.activeTasks.add, {
  apply: (target, thisArg, argumentsList) => {
    const task = argumentsList[0];
    const pid = Reflect.apply(
      target,
      PouchDB.activeTasks,
      [task]
    );
    console.log('Added task', pid, task.type);
    return pid;
  },
});
{% endhighlight %}
