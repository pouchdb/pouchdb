'use strict';

import { createError, MISSING_DOC } from 'pouchdb-errors';

import { META_LOCAL_STORE } from './util';

export default function (txn, id, callback) {
  if (txn.error) {
    return callback(txn.error);
  }

  txn.txn.objectStore(META_LOCAL_STORE).get(id).onsuccess = function (e) {
    const doc = e.target.result;

    if (!doc) {
      callback(createError(MISSING_DOC, 'missing'));
      return;
    }

    const result = doc.revs[doc.rev].data;
    result._id = doc.id;
    result._rev = doc.rev;

    callback(null, result);
  };
}
