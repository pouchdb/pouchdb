'use strict';

import { btoa, readAsBinaryString } from 'pouchdb-binary-utils';

function getAttachment(txn, docId, attachId, _, opts, cb) {
  if (txn.error) {
    return cb(txn.error);
  }

  const doc = opts.metadata;
  const rev = doc.revs[opts.rev || doc.rev].data;
  const digest = rev._attachments[attachId].digest;
  const attachment = doc.attachments[digest].data;

  if (opts.binary) {
    return cb(null, attachment);
  } else {
    readAsBinaryString(attachment, function (binString) {
      cb(null, btoa(binString));
    });
  }
}

export {
  getAttachment,
};
