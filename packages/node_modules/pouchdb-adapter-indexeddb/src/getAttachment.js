'use strict';

import { btoa, readAsBinaryString } from 'pouchdb-binary-utils';

export default function getAttachment(txn, docId, attachId, attachment, opts, cb) {
  if (txn.error) {
    return cb(txn.error);
  }

  const doc = opts.metadata;
  const data = doc.attachments[attachment.digest].data;

  if (opts.binary) {
    return cb(null, data);
  } else {
    readAsBinaryString(data, function (binString) {
      cb(null, btoa(binString));
    });
  }
}
