import { v4 as uuidV4 } from 'uuid';
import { stringMd5 } from 'pouchdb-md5';
import clone from './clone';

function rev(doc, deterministic_revs) {
  var clonedDoc = clone(doc);
  if (!deterministic_revs) {
    return uuidV4().replace(/-/g, '').toLowerCase();
  }

  delete clonedDoc._rev_tree;
  return stringMd5(JSON.stringify(clonedDoc));
}

export default rev;
