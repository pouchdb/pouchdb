/*
 * Simple task queue to sequentialize actions. Assumes
 * callbacks will eventually fire (once).
 */

class TaskQueue {
  constructor() {
    this.promise = Promise.resolve();
  }

  add(promiseFactory) {
    this.promise = this.promise
      // just recover
      .catch(() => { })
      .then(() => promiseFactory());
    return this.promise;
  }

  finish() {
    const output = this.promise;
    this.promise = this.promise.then(() => {}); // Release reference to the return value of this.promise so it can be garbage collected
    return output;
  }
}

export default TaskQueue;
